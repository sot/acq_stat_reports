--- task
---


mission_start_time:
   year: 1999
   month: 1
   day: 1


limit_bad_list: 100

templates:
   index_file: all_plot_report.html
   predefined_index_file: standard_report.html
   #report_file: gs_report.txt
   report_yaml_file: acq_report.yml


db:
   connect_info: sybase-aca-aca_read
   table: acq_stats_data
   time_start_field: tstart
   time_stop_field: tstart


data:

   count_field: "count(agasc_id)"

   rates:
      - name: failed_acq 
        value: "NOID"
        field: obc_id 

   loops:
      - bin_over: mag
        get: 
           - rate: failed_acq
        start: 10.0
        stop: 10.8
        bin: .1
        name: tail_mag

   main_table_fmt:
      - source: report 
        label: actual
        value: stars
        fmt: %d
      - source: expected 
        label: pred.
        value: stars
        fmt: %d
      - source: report 
        label: P Less
        value: pless
        fmt: %6.3f
      - source: report 
        label: P More
        value: pmore
        fmt: %6.3f
      - source: report 
        label: actual
        value: rate
        fmt: %6.3f
      - source: expected 
        label: pred.
        value: rate
        fmt: %6.3f

   loop_table_fmt:
      - source: report
        label: stars
        value: stars
        fmt: %d
      - source: report:
        label: rate
        value: rate
        fmt: %6.3f


   lookup_table_fmt:
      fields:
         - 'agasc_id as id'
         - obsid
         - mag
         - mag_obs
         - obc_id
      field_fmt:
         - %12s
         - %5s
         - %5.2f
         - %5.2f
         - %s
      order:
         - tstart



cgi_links:
   obsid: 
      url: https://icxc.harvard.edu/cgi-bin/aspect/starcheck_print/starcheck_print.cgi
      get: "?sselect=obsid;obsid1=%VALUE%"
   id:
      url:  https://icxc.harvard.edu/cgi-bin/aspect/get_stats/get_stats.cgi
      get: "?id=%VALUE%"
   agasc_id:
      url:  https://icxc.harvard.edu/cgi-bin/aspect/get_stats/get_stats.cgi
      get: "?id=%VALUE%"


plots:
# Report.pm knows how to make histogram and scatter plots
# the type is determined on a string match on the key of
# this hash (e.g. mag_histogram is a histogram)

# scatter and histogram require that a plot_name image gif 
# be specified.

# scatter and histogram also optionally pass an array directly to
# pgs_plot (the pgs_plot key).  This gets passed *before* the data
# is plotted

# histograms need a "bin_over" variable to define the X axis bins
# they also need a start, stop, and bin (which is bin size)
   mag_histogram:
      bin_over: mag
      start: 5.5
      stop: 11.5
      bin: .1
      plot_name: mag_histogram.gif
      pad_log: 1
      black:
         fields:
            - "count(agasc_id) as black"
         where:
            obc_id: ID
      red:
         fields: 
            - "count(agasc_id) as red"
         where:
            obc_id: NOID
         scale: 100
      pgs_plot:
#   #      toptitle: "Mags for good (black) and bad (red) acq stars"
         - toptitle: "N good (black) and bad (red) stars vs Mag" 
         - xtitle: 'Star magnitude (mag)'
         - ytitle: 'N stars (red is x100)'
         - lims:
            - 5
            - 12
            - ~
            - ~
         - logy: 1

   exp_mag_histogram:
      bin_over: mag
      start: 5.5
      stop: 11.5
      bin: .1
      plot_name: exp_mag_histogram.gif
      pad_log: 1
      black:
         fields:
            - "count(agasc_id) as black"
         scale: fraction
      red:
         interval: mission
         fields: 
            - "count(agasc_id) as red"
         scale: fraction
      pgs_plot:
         - toptitle: "Expected Magnitudes of Acquisition Stars" 
         - xtitle: 'Star Magnitude (mag)'
         - ytitle: 'Fraction of All Acq Stars'
         - lims:
            - 5
            - 12
            - ~
            - ~



   mag_pointhist:
      bin_over: mag
      start: 5.5
      stop: 11.5
      bin: .1
      plot_name: mag_pointhist.gif
      pad_log: 1
      include_error: 1
      black:
         fields:
            - "count(agasc_id) as black"
         where:
            obc_id: ID
      black_all:
         fields:
            - "count(agasc_id) as black_all"
      red:
         interval: mission
         fields: 
            - "count(agasc_id) as red"
         where:
            obc_id: ID
      red_all:
         fields: 
            - "count(agasc_id) as red_all"

      pgs_plot:
#   #      toptitle: "Mags for good (black) and bad (red) acq stars"
         - toptitle: "Acquisition Success vs Expected Mag" 
         - xtitle: 'Star magnitude (mag)'
         - ytitle: 'Fraction Acquired'
         - lims:
            - 5
            - 12
            - ~
            - ~
   zoom_mag_pointhist:
      bin_over: mag
      start: 10
      stop: 11
      bin: .05
      plot_name: zoom_mag_pointhist.gif
      pad_log: 1
      include_error: 1
      black:
         fields:
            - "count(agasc_id) as black"
         where:
            obc_id: ID
      black_all:
         fields:
            - "count(agasc_id) as black_all"
      red:
         interval: mission
         fields: 
            - "count(agasc_id) as red"
         where:
            obc_id: ID
      red_all:
         fields: 
            - "count(agasc_id) as red_all"

      pgs_plot:
         - toptitle: "Acquisition Success vs Expected Mag" 
         - xtitle: 'Star magnitude (mag)'
         - ytitle: 'Fraction Acquired'
         - lims:
            - 9.9
            - 11.1
            - ~
            - ~



   


   zoom_mag_histogram:
      bin_over: mag
      start: 10
      stop: 11
      bin: .05
      plot_name: zoom_mag_histogram.gif
      pad_log: 1
      black:
         fields:
            - "count(agasc_id) as black"
         where:
            obc_id: ID
      red:
         fields: 
            - "count(agasc_id) as red"
         where:
            obc_id: NOID
         scale: 100
      pgs_plot:
         - toptitle: "N good (black) and bad (red) stars vs Mag" 
         - xtitle: 'Star magnitude (mag)'
         - ytitle: 'N stars (red is x100)'
         - lims:
            - 9.9
            - 11.1
            - ~
            - ~
         - logy: 1


   id_per_obsid_histogram:
      table: acq_stats_id_by_obsid
      start: 0
      stop: 9
      bin: 1
      plot_name: id_per_obsid_histogram.gif
      pad_log: 0
      black:
         bin_over: id_cnt
         fields:
            - "count(*) as black"
      red:
         bin_over: noid_cnt
         fields:
            - "count(*) as red"
      pgs_plot:
         - toptitle: "ID Acq Stars per obsid (Interval)" 
         - ytitle: 'Number of obsids'
         - xtitle: 'Number of Acq Stars (red=NOID)'
         - lims:
            - -.5
            - 8.5
            - .1
            - ~
         - logy: 1
         - options:
            center: 1

   id_per_obsid_mission_histogram:
      interval: mission
      table: acq_stats_id_by_obsid
      start: 0
      stop: 9
      bin: 1
      plot_name: id_per_obsid_mission_histogram.gif
      pad_log: 0
      black:
         bin_over: id_cnt
         fields:
            - "count(*) as black"
      red:
         bin_over: noid_cnt
         fields:
            - "count(*) as red"
      pgs_plot:
         - toptitle: "ID Acq Stars per obsid (Mission)" 
         - ytitle: 'Number of obsids'
         - xtitle: 'Number of Acq Stars (red=NOID)'
         - lims:
            - -.5
            - 8.5
            - .1
            - ~
         - logy: 1
         - options:
            center: 1

       


#   color_histogram:
#      bin_over: color
#      start: -.5
#      stop: 2.0
#      bin: .1
#      plot_name: color_histogram.gif
#      pgs_plot:
#         - toptitle: "N good (black) and bad (red) stars vs Color"
#         - xtitle: 'Color (B-V)'
#         - ytitle: 'N stars (red is x100)'
#         - lims:
#            - -.5
#            - 2.0
#            - ~
#            - ~
#         - logy: 1
#
## for the scatter plots, x and y are passed directly into select
##  statements to retrieve the data

#   id_scatter:
#      x: mag_exp
#      y: (percent_not_tracking/100)
#      plot_name: tracking_scatter.gif
#      pgs_plot:
#         - logy: 1
#         - lims:
#            - 5
#            - 12
#            - ~
#            - ~
#         - toptitle: "Fraction not tracking vs Mag"
#         - xtitle: 'Star magnitude (mag)'
#         - ytitle: 'Fraction not tracking'
#         - x: 
#            - 5
#            - 12
#         - y: 
#            - .05
#            - .05
#         - color:
#            line: red
#         - plot: line
#
#
#
#
#   status_scatter:
#      x: mag_exp
#      y: (percent_not_tracking/100)+(percent_bad_status/100)
#      plot_name: status_scatter.gif  
#      pgs_plot:
#         - lims:
#            - 5
#            - 12
#            - ~
#            - ~
#         - toptitle: "Fraction ( Not Tracking + Bad Status) vs Mag"
#         - xtitle: 'Star magnitude (mag)'
#         - ytitle: 'Fraction nt or image status != 0'
#         - logy: 1
#         - x: 
#            - 5
#            - 12
#         - y: 
#            - .05
#            - .05
#         - color:
#            line: red
#         - plot: line
#

   delta_mag_scatter:
      x: mag
      y: mag_obs-mag
      where:
         obc_id: ID
      plot_name: delt_mag_scatter.gif
      pgs_plot:
         - lims:
            - 5
            - 12
            - ~
            - ~
         - toptitle: "Delta Mag vs Mag"
         - xtitle: 'AGASC magnitude (mag)'
         - ytitle: 'Observed - AGASC mag'
         - logy: 0
